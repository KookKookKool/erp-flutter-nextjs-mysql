# р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╕гр╕░р╕Ър╕Ъ ERP Backend

## ЁЯУЛ р╕ар╕▓р╕Юр╕гр╕зр╕бр╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ

р╕гр╕░р╕Ър╕Ъ ERP Backend р╕бр╕╡р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╣Ар╕Юр╕╖р╣Ир╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Вр╕нр╕Зр╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕кр╕│р╕Др╕▒р╕Н р╣Вр╕Фр╕вр╣Ар╕Йр╕Юр╕▓р╕░р╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕З Super Admin р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╣Ар╕бр╕╖р╣Ир╕нр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕нр╕Зр╕Др╣Мр╕Бр╕г

## ЁЯзк р╣Др╕Яр╕ер╣Мр╕Чр╕Фр╕кр╕нр╕Ър╕Чр╕╡р╣Ир╕бр╕╡р╕нр╕вр╕╣р╣И

### `test-integration.js`
**р╣Др╕Яр╕ер╣Мр╕Чр╕Фр╕кр╕нр╕Ър╕лр╕ер╕▒р╕Бр╕кр╕│р╕лр╕гр╕▒р╕Ъ Super Admin Creation**

#### р╕Др╕зр╕▓р╕бр╕кр╕▓р╕бр╕▓р╕гр╕Ц:
- р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕З database schema р╕кр╕│р╕лр╕гр╕▒р╕Ър╕нр╕Зр╕Др╣Мр╕Бр╕гр╣Гр╕лр╕бр╣И
- р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕Зр╕Хр╕▓р╕гр╕▓р╕З `users` р╣Бр╕ер╕░ `user_permissions`
- р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕З Super Admin р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
- р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Гр╕лр╣Йр╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╕Др╕гр╕Ър╕Чр╕╕р╕Бр╕кр╕┤р╕Чр╕Шр╕┤р╣М
- р╕Чр╕Фр╕кр╕нр╕Ър╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕нр╕╡р╣Ар╕бр╕е `admin_[ORG_CODE]`
- р╕Чр╕│р╕Др╕зр╕▓р╕бр╕кр╕░р╕нр╕▓р╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕Фр╕кр╕нр╕Ър╕лр╕ер╕▒р╕Зр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ

#### р╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╕гр╕▒р╕Щ:
```bash
npm run test:integration
```

#### р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З:
```
ЁЯзк Testing Full DatabaseManager Integration...
ЁЯУЭ Testing Super Admin creation manually...
   Org Code: TEST2507101234
   Schema: org_test2507101234
   Expected Email: admin_TEST2507101234
тЬЕ Schema created
тЬЕ Tables created
тЬЕ Super Admin created
тЬЕ Granted 8 sample permissions
ЁЯУК Results:
   Super Admin users: 1
   Total permissions: 8
   Admin details:
     Email: admin_TEST2507101234
     Name: Super Admin
     Role: SUPER_ADMIN
     Active: YES
     Expected Email: admin_TEST2507101234
     Match: тЬЕ YES
тЬЕ Cleanup completed
ЁЯОЙ Super Admin creation test PASSED!
```

## ЁЯОп р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ

### 1. Database Schema Creation
- р╕кр╕гр╣Йр╕▓р╕З schema `org_[orgcode]` р╕кр╕│р╣Ар╕гр╣Зр╕И
- р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е MySQL р╣Др╕Фр╣Й

### 2. Table Structure
- р╕кр╕гр╣Йр╕▓р╕Зр╕Хр╕▓р╕гр╕▓р╕З `users` р╕Юр╕гр╣Йр╕нр╕б ENUM role р╕Чр╕╡р╣Ир╕гр╕зр╕б SUPER_ADMIN
- р╕кр╕гр╣Йр╕▓р╕Зр╕Хр╕▓р╕гр╕▓р╕З `user_permissions` р╕Юр╕гр╣Йр╕нр╕б foreign key constraints
- Primary keys р╣Бр╕ер╕░ indexes р╕Чр╕│р╕Зр╕▓р╕Щр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

### 3. Super Admin Creation
- р╕нр╕╡р╣Ар╕бр╕ер╣Гр╕Кр╣Йр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ `admin_[ORG_CODE]`
- р╕Кр╕╖р╣Ир╕нр╣Ар╕Ыр╣Зр╕Щ "Super Admin"
- Role р╣Ар╕Ыр╣Зр╕Щ "SUPER_ADMIN"
- р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ "123456"
- р╕кр╕Цр╕▓р╕Щр╕░р╣Ар╕Ыр╣Зр╕Щ active

### 4. Permission Assignment
- р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╕Чр╕╕р╕Бр╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╣Гр╕Щр╕гр╕░р╕Ър╕Ъ
- Permissions р╕Др╕гр╕нр╕Ър╕Др╕ер╕╕р╕бр╕Чр╕╕р╕Бр╣Вр╕бр╕Фр╕╣р╕е
- р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щ user_permissions р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

### 5. Data Integrity
- р╣Др╕бр╣Ир╕бр╕╡ constraint violations
- Foreign key relationships р╕Чр╕│р╕Зр╕▓р╕Щр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- Data types р╣Бр╕ер╕░ values р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

## ЁЯФз р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ

### р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕Юр╕Ър╕Ър╣Ир╕нр╕в:

#### 1. Connection Error
```
тЭМ Error: connect ECONNREFUSED 127.0.0.1:3306
```
**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:** р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ MySQL server р╕Бр╕│р╕ер╕▒р╕Зр╕Чр╕│р╕Зр╕▓р╕Щ
```bash
npm run docker:up
```

#### 2. Permission Denied
```
тЭМ Error: Access denied for user 'erp_app'@'localhost'
```
**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:** р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ username/password р╣Гр╕Щр╣Др╕Яр╕ер╣М `.env`

#### 3. Table Already Exists
```
тЭМ Error: Table 'users' already exists
```
**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:** р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╕Ир╕░р╕Чр╕│р╕Др╕зр╕▓р╕бр╕кр╕░р╕нр╕▓р╕Фр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ р╕лр╕▓р╕Бр╕вр╕▒р╕Зр╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓р╣Гр╕лр╣Йр╕ер╕Ъ test schema р╕Фр╣Йр╕зр╕вр╕Хр╕Щр╣Ар╕нр╕З

## ЁЯУК р╣Ар╕бр╕Чр╕гр╕┤р╕Бр╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ

### Coverage Areas:
- тЬЕ Database Operations (100%)
- тЬЕ Schema Management (100%)  
- тЬЕ User Creation (100%)
- тЬЕ Permission Assignment (100%)
- тЬЕ Data Validation (100%)
- тЬЕ Cleanup Process (100%)

### Test Execution Time:
- р╣Вр╕Фр╕вр╣Ар╕Йр╕ер╕╡р╣Ир╕в: 2-5 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡
- р╕гр╕зр╕бр╣Ар╕зр╕ер╕▓р╕Бр╕▓р╕гр╕Чр╕│р╕Др╕зр╕▓р╕бр╕кр╕░р╕нр╕▓р╕Ф

## ЁЯЪА р╕Бр╕▓р╕гр╕Вр╕вр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╣Гр╕Щр╕нр╕Щр╕▓р╕Др╕Х

### р╣Бр╕Щр╕зр╕Чр╕▓р╕Зр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б:
1. **API Integration Tests** - р╕Чр╕Фр╕кр╕нр╕Ъ REST API endpoints
2. **Load Testing** - р╕Чр╕Фр╕кр╕нр╕Ър╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Ю
3. **Security Testing** - р╕Чр╕Фр╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕в
4. **End-to-End Tests** - р╕Чр╕Фр╕кр╕нр╕Ъ workflow р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
5. **Frontend Integration** - р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ъ Flutter

### р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕бр╕╖р╕нр╕Чр╕╡р╣Ир╣Бр╕Щр╕░р╕Щр╕│:
- **Jest** - Unit testing framework
- **Supertest** - API testing
- **Artillery** - Load testing
- **Cypress** - E2E testing

## ЁЯУЭ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Бр╕▓р╕гр╕Юр╕▒р╕Тр╕Щр╕▓

- **v1.0** - р╕Чр╕Фр╕кр╕нр╕Ъ Super Admin creation р╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щ
- **v1.1** - р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ permissions р╕Др╕гр╕Ър╕Др╕гр╕▒р╕Щ
- **v1.2** - р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Др╕зр╕▓р╕бр╕кр╕░р╕нр╕▓р╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е
- **v1.3** - р╣Ар╕Юр╕┤р╣Ир╕б detailed reporting
